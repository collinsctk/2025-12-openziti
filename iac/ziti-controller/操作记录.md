### 创建/opt/ziti-controller/.env
```shell
mkdir -p /opt/ziti-controller
cat > /opt/ziti-controller/.env << 'EOF'
# Controller 管理口（控制平面）地址
ZITI_CTRL_ADVERTISED_ADDRESS=ziti-controller.mingjiaocf.com
ZITI_CTRL_ADVERTISED_PORT=6262

# Controller 边缘口（Edge API）地址
ZITI_CTRL_EDGE_ADVERTISED_ADDRESS=ziti-controller.mingjiaocf.com
ZITI_CTRL_EDGE_ADVERTISED_PORT=1280

# 管理员账号和密码
ZITI_USER=admin
ZITI_PWD=Cisc0123
EOF
```

### 创建docker-compose.yaml
```shell
cat > /opt/ziti-controller/docker-compose.yaml << 'EOF'
services:
  ziti-controller:
    image: openziti/ziti-controller:latest
    container_name: ziti-controller
    env_file:
      - ./.env
    # 新增下面这段，引导生成 PKI、数据库和配置
    environment:
      - ZITI_BOOTSTRAP=true
      - ZITI_BOOTSTRAP_PKI=true
      - ZITI_BOOTSTRAP_DATABASE=true
      - ZITI_BOOTSTRAP_CONFIG=true
    ports:
      - "1280:1280/tcp"  # Edge API（客户端/CLI 登陆）
      - "6262:6262/tcp"  # 控制平面（Edge Router 注册）
    volumes:
      - ./ziti-controller-data:/persistent
    restart: unless-stopped
EOF
```

### 拉起容器
```shell
cd /opt/ziti-controller/
docker compose up -d

```

### 安装ziti cli工具
```shell
curl -sS https://get.openziti.io/install.bash | bash -s openziti

```
### 测试登录
```shell
[root@ip-10-1-1-38 ziti-controller]# ziti edge login ziti-controller.mingjiaocf.com:6262 -u admin -p Cisc0123 -y
Untrusted certificate authority retrieved from server
Verified that server supplied certificates are trusted by server
Server supplied 2 certificates
Server certificate chain written to /root/.config/ziti/certs/ziti-controller.mingjiaocf.com
Token: 2adf3386-d3bb-4a8c-8f7b-30c070cf7672
Saving identity 'default' to /root/.config/ziti/ziti-cli.json

```

### 创建Edge Router的JWT
```shell
[root@ip-10-1-1-38 ~]# ziti edge create edge-router aws-edge-router \
  --role-attributes "public,aws-host" \
  --jwt-output-file aws-router.jwt
New edge router aws-edge-router created with id: DaHg2Pts-J
Enrollment expires at 2025-04-20T15:27:25.007Z
```

### 查看JWT
```shell
[root@ip-10-1-1-38 ~]# ls
aws-router.jwt
[root@ip-10-1-1-38 ~]# cat aws-router.jwt 
eyJhbGciOiJSUzI1NiIsImtpZCI6ImRkZmZhOWFhNjBlNzBjNTg1ZTkzODhkNGIxZmY1NTUwNGIxZGJlMDIiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3ppdGktY29udHJvbGxlci5taW5namlhb2NmLmNvbTo2MjYyIiwic3ViIjoiRGFIZzJQdHMtSiIsImF1ZCI6WyIiXSwiZXhwIjoxNzQ1MTYyODQ1LCJqdGkiOiI0ZjZmMWY0MS05ZjQ1LTQ5NmYtYTU2YS0wMjM0YWZjYWYwNDYiLCJlbSI6ImVyb3R0IiwiY3RybHMiOlsidGxzOnppdGktY29udHJvbGxlci5taW5namlhb2NmLmNvbTo2MjYyIl19.rnum6GvUqCP4sgSC1yWMFqfJsCNLfvuKdcHrsCVu1BIOBJyCtECrAtgWpuyuS2GCyZnBDI3AVjoj-Se7097PWhOpKt1Y3095_t4L5JCyvzvQ37h4SS7SMTYoziMR411_PnDG6x0TI70mdnMch3P2yGOyPYrQadfjDnTJZW7rONhQQqu8ex4Jx-vGrYUdTY-lIWpDkQRcBJtwGbN044nEFRaw0xqhK7TSlWflxxsrdwAeel0dYBfRvTFIyrKXQI2q2rWka2EoZvZhoCA8JyxfdKfU18V0ZiRmMBr1-v_Ap0eHQ85dYl8W0vMRDrPV2gnuvcwdj0dR5x0qk8WT3DwngbAZTjKRjuHvtQZi1q34tLRC988PodhwOVDdvRe42N03EVjrDF7KwHRiRqtf_zWp83pgCutUzFvv5z7fOjq2j5lg-s0G1X1ACuhVzSu0x3UPoMwXaPLJtW4YKhLif9v3fjx-_HAGeNuv_sn29yTO6cwAdGjLT-zkP9R0Cxw2ku-mXaQlZi_MLfFuQyaGutCNEvg8knaEdmUlXNXG3BVFYZEkNXG5bGyu9VXtPkWXxm8bDT7dY_AOj2UkJKNqBL31wiY9l9rBu7SHn_TsxUEHBVHbeUekeMKxVdvX1hmLVOEqfaLKABqs4fEhw6RSnd8h5NXb2Zi0XggyRClU4NAxGiY
```

### 创建ClientPC.jwt
```shell
[root@ip-10-1-1-79 ~]# ziti edge create identity user ClientPC \
  -a "nginx-clients" \
  -o ClientPC.jwt
Command "user" is deprecated, this command is deprecated, specifying identity type is no longer required
New identity ClientPC created with id: g6y0I.14bj
Enrollment expires at 2025-04-24T10:50:05.898Z

[root@ip-10-1-1-79 ~]# cat ClientPC.jwt
eyJhbGciOiJSUzI1NiIsImtpZCI6IjA3YjRiMzY1YTllN2Q2M2FjMzUxYzU2ZjY5ZmFkMjZiODNlOTM5YjYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3ppdGktY29udHJvbGxlci5taW5namlhb2NmLmNvbTo2MjYyIiwic3ViIjoiZzZ5MEkuMTRiaiIsImF1ZCI6WyIiXSwiZXhwIjoxNzQ1NDkxODA1LCJqdGkiOiIxMzM0MGM2Yi1mMDc2LTQ0YTEtOTIzNC01NDA3ZDc2ZTY0YTEiLCJlbSI6Im90dCIsImN0cmxzIjpbInRsczp6aXRpLWNvbnRyb2xsZXIubWluZ2ppYW9jZi5jb206NjI2MiJdfQ.wkYSdtGpr7LXXwbVRD3n5RSJbZmNMu8M2tKuBrkvKfIL9potClMiFtiQrZaJCp2ldKWGykzotSVw14AdtXaJmhsv17MGH6E6wM0hrVmg9cmYahk8MR-lrYtn6-jHoYNhhEhJYKm87QRsC1L6nIH9fGvqsCQMr_Y2Mcbt0e21St9vpMFddHHR6Tfv9v-bMPlff0NS3yL-THy0k2lnOoIpRr7dsFSkIm7OEDeYqzdOzsm0WwHFwICVzYFjrzKs7g03RysV4KZ6SSlLly0IeDZWMaxJqSifm0PkJXLmv3GoBWAhX8-XgAPjEGCKGv7EoOFkA4sFfbPYUpPdhp8IcUxe9fTtUDTg4CoSZH3JQz8AqtknhQS6og5XZvKc2xkOd7ZxW1Hy91LHqViz6s92kjLssvMksuWKfWcZVsB5pI1Oz8DnXtA7KQG4BFCyBvRARlv2WzWoPnwQMG_W1Rtb4TTAS5EH07Be4Q2JbyZ5BaEpUSmhraRAa4sS3IT007G94SmdirPTiV2h3TxS_nfMqnkW4hkW_w_ki3n_tVkXHjvfblN-DW823tWAi4sVoyFWm9R9nnfdYqX_8xoAZdXBeNeywm_9qYSDNL1kD3yrNy0f78XufgJr2xBXK7xZ3htpPKJKIuvmDSm_CCBMx8JzG4c19kRPXVoajZSP5mTeTfM-sJo
```

### 添加策略
```shell
ziti edge delete config caddy-intercept
ziti edge delete config caddy-host
ziti edge delete service caddy-service
ziti edge delete service-policy caddy-dial
ziti edge delete service-edge-router-policy caddy-bind

```