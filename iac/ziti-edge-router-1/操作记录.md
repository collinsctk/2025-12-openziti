### 创建环境变量, 需要替换为controller的aws-router.jwt的内容
```shell
mkdir -p /opt/ziti-router

JWT=eyJhbGciOiJSUzI1NiIsImtpZCI6IjczNDE1NWRjZTMyODY3ZWNkM2FmOWY1YWM1NTQyZGVhZjJjZjg3ZGQiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3ppdGktY29udHJvbGxlci5taW5namlhb2NmLmNvbTo2MjYyIiwic3ViIjoiZUNXVUc5dmp4QiIsImF1ZCI6WyIiXSwiZXhwIjoxNzQ1MTY1MTQ3LCJqdGkiOiIyMmI1OThlNy1iYTMwLTRiOWItYTMzNi05MjE0YzQxZDU4MWQiLCJlbSI6ImVyb3R0IiwiY3RybHMiOlsidGxzOnppdGktY29udHJvbGxlci5taW5namlhb2NmLmNvbTo2MjYyIl19.VJMFN_Mc3ehPEPFZ55u-YgVEZP4B71hKtF1NXCKnDFxGKZXIkFTYVMekdG8QOxD8-JmmFEqQBbejhHCjeWSRY1P1TjZKWKlbW9O0nSIruRpKajag3NyUCoIXwamsgCUE1kIo7SGJ1PMvLmeSAf4ElGJZoZwKUq8Ba-MKzb3ljgCZJS3oPGgQawKpQWbCyVBGZOUaI5mYI5qNSelaH2L832QoQ0w2TljkbD7P5AF6sbE_IZwmhYfsi0dx-uDMDCykUZcPb4UccTjd2MkhZ97oTfoeqTquTHzy7ItG1G6oQKebTZUpWnje7EDFp_WajlfQmPCA6AD2EV02NS5PAxYXTEqbbKIVKCQLvOPwaH0b69_qBxWInvFn4xjrpoEGsjiDWxyVoSVjg3PMSrAtns0_faEt-UKMHAJL2vOpj0COSt0DXJiU0oXDtX_GBFDxKltsGqdGL2UFV4JoJVQdnDbe1J2ulvx-urqVCRW5Vic36xtR-LAN6JRl--2sl4vsXoE8mEQgjC3dLI_4L4WSmL_nLpTe16DryX5bkF0xn11B0ckqoZUuA-1oG2mA38h2GKhqT_rTyssFIHM8ptxu7KTCreTHxLaJ5Ou35cqln15P2NNNJqXOEbzNHuxJhCQg6iyXkCtT9AhIQirJX39jDKaxKkj69FR26RSBlhdRYeqjGUs

cat > /opt/ziti-router/.env <<EOF
ZITI_ENROLL_TOKEN=$JWT
ZITI_CTRL_ADVERTISED_ADDRESS=ziti-controller.mingjiaocf.com
ZITI_CTRL_ADVERTISED_PORT=6262
EOF

```

### 创建docker-compose.yaml
```shell
cat > /opt/ziti-router/docker-compose.yaml << 'EOF'
services:
  ziti-edge-router:
    image: openziti/ziti-router:latest
    container_name: ziti-edge-router
    env_file:
      - /opt/ziti-router/.env
    environment:
      - ZITI_ROUTER_NAME=aws-edge-router
      - ZITI_ROUTER_ADVERTISED_ADDRESS=ziti-edge-router-1.mingjiaocf.com
      - ZITI_ROUTER_PORT=3022
      - ZITI_ROUTER_ROLES=public,aws-host
    ports:
      - "3022:3022/tcp"    # 客户端和本地路由器拨入
      - "10080:10080/tcp"  # 路由器间链路监听
    volumes:
      - ./ziti-router-data:/persistent
    restart: unless-stopped
EOF

cd /opt/ziti-router/
docker compose up -d

```

### 在controller上查看edge-routers
```shell
[root@ip-10-1-1-251 ziti-controller]# ziti edge list edge-routers
╭────────────┬─────────────────┬────────┬───────────────┬──────┬────────────╮
│ ID         │ NAME            │ ONLINE │ ALLOW TRANSIT │ COST │ ATTRIBUTES │
├────────────┼─────────────────┼────────┼───────────────┼──────┼────────────┤
│ eCWUG9vjxB │ aws-edge-router │ true   │ true          │    0 │ aws-host   │
│            │                 │        │               │      │ public     │
╰────────────┴─────────────────┴────────┴───────────────┴──────┴────────────╯
results: 1-1 of 1
````

### 创建ziti-service
```shell
mkdir -p /opt/ziti-service
cd /opt/ziti-service

cat > /opt/ziti-service/cert.pem << 'EOF'
-----BEGIN CERTIFICATE-----
MIIEozCCA4ugAwIBAgIUU0VwpOEKGil8ZAqXpI+2gvAeDtUwDQYJKoZIhvcNAQEL
BQAwgYsxCzAJBgNVBAYTAlVTMRkwFwYDVQQKExBDbG91ZEZsYXJlLCBJbmMuMTQw
MgYDVQQLEytDbG91ZEZsYXJlIE9yaWdpbiBTU0wgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRMwEQYDVQQIEwpDYWxpZm9ybmlh
MB4XDTI1MDQyMDEzNDMwMFoXDTQwMDQxNjEzNDMwMFowYjEZMBcGA1UEChMQQ2xv
dWRGbGFyZSwgSW5jLjEdMBsGA1UECxMUQ2xvdWRGbGFyZSBPcmlnaW4gQ0ExJjAk
BgNVBAMTHUNsb3VkRmxhcmUgT3JpZ2luIENlcnRpZmljYXRlMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5mjw0Z748W2JxOKUejbWJrdP3/S5kapNio3p
1pBSYm11yFdkH4f07YMF9pPs9FdEeoctFW7rrMXJeSjJE0TwkXfbaHQ3hbltlRzz
7ctfzCVtG0cXIH3CmAZ/YrB1VgaSPdKweiJpIH2zL3JXpZVT7CCHFmkLx244vNV6
TmowRuLU+EupJrKiOd7cfJQ2h32lz8qfbk8MYQriRJ7Cg4um49dTAO124WJiAhAp
GRuVnr1k+DdqBQBDP7zZ/BLna1gX2MTEjTcfT54yHTDtXup4xAl/3efMT0DsBB72
GQgwBkwYt1AMQEMwobW8+i881ZwjvCJeKLIeSxX6A1CixQc3uQIDAQABo4IBJTCC
ASEwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcD
ATAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRkx8wKfmrkYY40xio1Zvs5xB+cfjAf
BgNVHSMEGDAWgBQk6FNXXXw0QIep65TbuuEWePwppDBABggrBgEFBQcBAQQ0MDIw
MAYIKwYBBQUHMAGGJGh0dHA6Ly9vY3NwLmNsb3VkZmxhcmUuY29tL29yaWdpbl9j
YTAmBgNVHREEHzAdght6aXRpLXNlcnZpY2UubWluZ2ppYW9jZi5jb20wOAYDVR0f
BDEwLzAtoCugKYYnaHR0cDovL2NybC5jbG91ZGZsYXJlLmNvbS9vcmlnaW5fY2Eu
Y3JsMA0GCSqGSIb3DQEBCwUAA4IBAQAN31yrZJH5povvm/pt/aiQSo5eymyz2iwh
jA05PBLBUu2q9WbMA0QSiSLPi0Sg2AJRCjpIvv22BMeYAnzRNMfQTpGFPH7TCxFo
rg/UR37rMGupqH3Ibwo6+JBa/ojm8KgVEVYkjPPyKsiKumcFI+GPQA2HpX9XgJ1Y
EI00QGLxBQ8OPK5BSJLzlMpr15g8yX9adf5awaNNO/3VgrhF8PKw8DlWQKS0Ygn/
87rVwoThnSC6B/u4YffAjaIQxjBLzWVznbXWLeDrlxJkC3F4Rv6+0/45GPPHl2Uq
cn+wIjUcXZGmcuJBRKT4Pag5MgeMSc+ccL1zQZKivX6+3DE3zW6O
-----END CERTIFICATE-----
EOF

cat > /opt/ziti-service/key.pem << 'EOF'
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDmaPDRnvjxbYnE
4pR6NtYmt0/f9LmRqk2KjenWkFJibXXIV2Qfh/TtgwX2k+z0V0R6hy0Vbuusxcl5
KMkTRPCRd9todDeFuW2VHPPty1/MJW0bRxcgfcKYBn9isHVWBpI90rB6ImkgfbMv
clellVPsIIcWaQvHbji81XpOajBG4tT4S6kmsqI53tx8lDaHfaXPyp9uTwxhCuJE
nsKDi6bj11MA7XbhYmICECkZG5WevWT4N2oFAEM/vNn8EudrWBfYxMSNNx9PnjId
MO1e6njECX/d58xPQOwEHvYZCDAGTBi3UAxAQzChtbz6LzzVnCO8Il4osh5LFfoD
UKLFBze5AgMBAAECggEAM/0exXW03yjjqqijbvYbmQ3IuJRMINmH+Ijv5+mVpT7k
kilh3pl7QvJK8KnNEA721RzWJ91o0Qmp3aw9vprSG0irmaSLeKFv3/Lx+Uhn27Tg
KwT962dk9o+Uw6xkNV5zNf7psg08okeqnDyVGTgaARAP2xclwMCWjckveS0NqpiL
Vx/67cuGAT0rHgPwmiEcOvVWsFcH8tSpaxJjM/3JnZAPXAXzqQRPSI1NxZ7qTp1r
PdqvwpJCcVLWnhdYArI6qE/BkGoklN1MA6LWgMgdja//k5SOpdhcgp8AzQ7ltnHa
gAWCuycJcmZudDc02XRTTT7OwBASkgkN1S2gi1tTVwKBgQD91EytxjC8x+KMoeww
MZos85s55coF2Hs/CrEEp7+nC53WdezUrK0QNBxjOiDDXuwZ5i41sm2i3a6fjCsT
9swKsfVoYrhnkwvwXNeYcF8rwBACsZTpNQ8pNABkOIVS+QpbhjZtGVlGuoSDwtl6
N8Dvnoz1mivw0ODkGsOclByTrwKBgQDoYV6woMUjpHbSfJdO3NKYbVyYcc12VhGn
iqPklCtBoew1Gpl1xoBJtqzDMpfVPmThPOs32YcJMlSVvc0cqHPlJtZkDHJSjF5O
TbzqihKG75svtagrmzhOsY4TxqKVN/14blc/bETwIvAUzn/5ZbyVQGMpIMusjbup
fQ2fNh79FwKBgQDhgG2K6Is9+9qSE/yQKFEPZHDgM/yRyuxbanUvbJRApHpaIDQC
EVJDFfiuUuLujvL0Y2FkRRtP2OAdUFqpBtXpHoamcSXgpmux49mJzTNP2/adXgSs
Vn4cnd1HLEuOFkAUZZ0Oublts6Csqjupb8TRXKtgOtKUxA03uWtVPORScwKBgQC/
zH4nMssEHB6mpIcOZFy9yqX+fQ+keG2h52BWraT2Svt26Tl4aBpCvS/i/MMtEo6Z
CXrrYfN+t7fwz/OXj8H4hRG3Cj7hu1GrN6aRvtyD2wgvXLQtKbRT32DxGaXfm5Lt
78S7aFWODogx5C7kXgBFABvYOmVhSqp1ve2cV0NEiQKBgBwT00l01YAYLMGJuZIO
qJm98f039crAq0ZiYwuIjFeWeKiMb1675b+0J96FdyUnviE7c7m943uUUv1grc4H
r5JUrMDPsqGRKPBrzLsBOoplaEe/CFiqxRFIEMRWQNz8J3nLKErTetRrpGEI5sY8
0h2wpkISEyhkjZF1ZiG27L90
-----END PRIVATE KEY-----
EOF


cat > /opt/ziti-service/Caddyfile << 'EOF'
ziti-service.mingjiaocf.com {
  # 加载外部提供的证书和私钥
  tls /etc/caddy/cert.pem /etc/caddy/key.pem

  # 返回 Hello World 页面
  respond "/" "<h1>Qytang ZTNA Hello World</h1>"
}
EOF


cat > /opt/ziti-service/docker-compose.yaml << 'EOF'
services:
  caddy:
    image: caddy:latest
    container_name: ziti-caddy
    ports:
      - "443:443/tcp"
    volumes:
      # 站点配置
      - /opt/ziti-service/Caddyfile:/etc/caddy/Caddyfile:ro
      # 你的证书和私钥
      - /opt/ziti-service/cert.pem:/etc/caddy/cert.pem:ro
      - /opt/ziti-service/key.pem:/etc/caddy/key.pem:ro
      # Caddy 运行时和缓存
      - caddy_data:/data
      - caddy_config:/config
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
EOF

docker compose up -d

```